---
import { fetchPicture } from "../lib/picture.js";

const data = Astro.props.source;
const alt = Astro.props.alt || "";
const className = Astro.props.class || "";
const style = Astro.props.style || "";
const picture = await fetchPicture(data);
---

<picture>
    {Object.entries(picture).map(([mediaQuery, { img, srcset }]) => {
        return (
            <>
                <source media={mediaQuery} type="image/avif" srcSet={`${srcset.avif["1x"]} 1x, ${srcset.avif["2x"]} 2x, ${srcset.avif["3x"]} 3x`} />
                <source media={mediaQuery} type="image/webp" srcSet={`${srcset.webp["1x"]} 1x, ${srcset.webp["2x"]} 2x, ${srcset.webp["3x"]} 3x`} />
            </>
        );
    })}
    <img src={Object.values(picture)[0]?.img} alt={alt} class={className} style={style} />
</picture>